Обработка блока выполняется по 512 бит.
Формируется 128 битовое значение.

**Этапы работы**:
1. Дополнения файла;
2. Инициализация внутреннего буфера;
3. Поблочная обработка входного файла;
4. Формирование выходного значения.

![[Pasted image 20240107231057.png]]
*ФС — функция сжатия*

### Дополнение файла

К исходному сообщению добавляются:
- бит $1$;
- биты $0$ так, что длина блока полученного блока $L\mod 512=448$.
- длина исходного сообщения до добавления ($64$ бита).

$\underbrace{\textcolor{gray}{\text{Исходное сообщение}}\space\space\underbrace{100…000}_{\text{доп.биты}}\space\space\underbrace{\text{Длина исходного сообщения}}_{\text{64 бита}} }_{\text{Дополненное сообщение, кратное 512}}$

### Инициализация вектора $H$ ($MD$-буфера)

**Вектор** $H$ — $128$-битный вектор, инициализируемый $32$-битными словами:
$$H=(H_1,H_2,H_3,H_4)$$
$H_1:01\space23\space45\space67_{16}$
$H_1:89\space AB\space CD\space EF_{16}$
$H_1:FE\space DC\space BA\space98_{16}$
$H_1:76\space54\space32\space21_{16}$

### Обработка блока данных

1. Загружается блок данных сообщения $M$ в переменную $X$.
2. Инициализируются вспомогательные переменные $(A,B,C,D)=(H_1,H_2,H_3,H_4)$.
3. Выполняются три раунда:
	>Определим три вспомогательные функции, которые принимают на вход три $32$-битных слова и возвращают одно:
	$F(X,Y,Z)=XY\lor\lnot XY$
	$G(X,Y,Z)=XY\lor YZ \lor XZ$
	$H(X,Y,Z)=X\oplus Y\oplus Z$
	``` pascal
	for i=0 to 15 do
		T = A + F(B, C, D) + X[Z[r][i]] + K[r] // F заменяется на G, H на 2 и 3 р.
		(A, B, C, D) = (D, T << S[r][i], B, C)
	end for
	```
	>Здесь 
	$Z_r$ — вспомогательный массив выбора ячеек раунда $r$ такой, что:
	$Z_1=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]$
	$Z_2=[0,4,8,12,1,5,9,13,2,6,10,14,3,7,11,15]$
	$Z_3=[0,8,4,12,2,10,6,14,1,9,5,13,3,11,7,15]$
	——
	$K_r$ — некоторая величина на раунде $r$ такая, что:
	$K_1=0_{16}$
	$K_2=5A 82 79 99_{16}$
	$K_3=6ED9EBA1_{16}$
	——
	$S_r$ — коэффициент сдвига раунда $r$ такой, что:
	$S_1=[3,7,11,19,3,7,11,19,3,7,11,19,3,7,11,19]$
	$S_2=[3,5,9,13,3,5,9,13,3,5,9,13,3,5,9,13]$
	$S_3=[3,9,11,15,3,9,11,15,3,9,11,15,3,9,11,15]$
4. $(H_1,H_2,H_3,H_4)\mathrel{+}=(A,B,C,D)$.

### Заключение

Результатом предыдущих пунктов будет являться вектор $H$, представляющий собой $128$-битный дайджест сообщения.

### Схема

![[Pasted image 20240108010047.png]]
